BIN=exploit
# CC=musl-gcc
CC=gcc
CCFLAGS=-static -lbpf
all:hack

hack:
	@{ \
		echo "#include <linux/bpf.h>"; \
		echo ""; \
		echo "char instrs[] = {"; \
	} > bpf_program.h && \
    (clang -target bpf -c prog.S -o - | llvm-objcopy-19 -O binary /proc/self/fd/0 - | xxd -i) >> bpf_program.h && \
    echo "};" >> bpf_program.h && \
	$(CC) $(BIN).c -o $(BIN) $(CCFLAGS)